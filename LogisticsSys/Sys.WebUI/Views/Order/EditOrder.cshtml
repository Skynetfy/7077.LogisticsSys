@using Sys.Common
@using Sys.Entities
@using Sys.WebUI.Models
@{
    Layout = null;
    var orderview = ViewData["OrderInfo"] as OrderView;
}

<h4 id="breadcrumbs" class="page-header">订单修改</h4>
<form method="post" action="@Url.Action("EditOrder")" data-parsley-validate class="form-horizontal form-label-left">
    <div id="alert-infor" class="alert alert-success alert-dismissible" role="alert" style="display: none;">
        <strong>错误!</strong>
        <label></label>
    </div>
    <input type="hidden" name="orderId" value="@orderview.Id" />
    <h5>寄件人信息</h5>
    <hr />
    <div class="form-group">
        <label class="control-label col-md-3 col-sm-3 col-xs-12" for="orderno">
            订单号
        </label>
        <div class="col-md-6 col-sm-6 col-xs-12">
            <input type="text" id="orderno" value="@orderview.OrderNo" name="orderno" disabled class="form-control col-md-7 col-xs-12">
        </div>
    </div>
    <div class="form-group">
        <label class="control-label col-md-3 col-sm-3 col-xs-12" for="goodstype">
            货物类型
        </label>
        <div class="col-md-6 col-sm-6 col-xs-12">
            <input type="text" id="goodstype" value="@orderview.GoodsTypeName" disabled class="form-control col-md-7 col-xs-12">
        </div>
    </div>
    <div class="form-group">
        <label class="control-label col-md-3 col-sm-3 col-xs-12" for="transportationway">
            货物运输类型
        </label>
        <div class="col-md-6 col-sm-6 col-xs-12">
            <input type="text" id="transportationway" value="@orderview.TransportationWay" disabled class="form-control col-md-7 col-xs-12">
        </div>
    </div>
    <div class="form-group">
        <label class="control-label col-md-3 col-sm-3 col-xs-12" for="goodsweight">
            货物重量(千克) <span class="required">*</span>
        </label>
        <div class="col-md-6 col-sm-6 col-xs-12">
            <input type="text" id="goodsweight" name="goodsweight" onblur="goodsweightblur()" value="@orderview.GoodsWeight" required="required" data-parsley-type="number" data-parsley-min="1" class="form-control col-md-7 col-xs-12">
        </div>
    </div>
    <div class="form-group">
        <label class="control-label col-md-3 col-sm-3 col-xs-12" for="isoutphoto">
            开箱费（元）
        </label>
        <div class="col-md-6 col-sm-6 col-xs-12">
            <input type="text" id="isoutphoto" value="@orderview.IsOutPhoto" disabled class="form-control col-md-7 col-xs-12">
        </div>
    </div>
    @*<div class="form-group">
            <label class="control-label col-md-3 col-sm-3 col-xs-12" for="exchangerate">
                当日汇率
            </label>
            <div class="col-md-6 col-sm-6 col-xs-12">
                <input type="text" id="exchangerate" value="@orderview.ExchangeRate" disabled class="form-control col-md-7 col-xs-12">
            </div>
        </div>
        <div class="form-group">
            <label class="control-label col-md-3 col-sm-3 col-xs-12" for="arrivepayvalue">
                到付金额
            </label>
            <div class="col-md-6 col-sm-6 col-xs-12">
                <input type="text" id="arrivepayvalue" value="@orderview.ArrivePayValue" disabled class="form-control col-md-7 col-xs-12">
            </div>
        </div>*@
    <div class="form-group">
        <label class="control-label col-md-3 col-sm-3 col-xs-12" for="gjdfy">
            国际段费用(元)
        </label>
        <div class="col-md-6 col-sm-6 col-xs-12">
            <input type="text" id="gjdfy" name="gjdfy" readonly="readonly" value="@orderview.OrderFrees" required="required" data-parsley-type="number" data-parsley-min="1" class="form-control col-md-7 col-xs-12">
        </div>
    </div>
    <br />
    <h5>收件人信息</h5>
    <hr />
    <div class="form-group">
        <label class="control-label col-md-3 col-sm-3 col-xs-12" for="chinacityid">
            订单省份
        </label>
        <div class="col-md-6 col-sm-6 col-xs-12">
            <input type="text" id="chinacityid" value="@orderview.ChinaCityName" disabled class="form-control col-md-7 col-xs-12">
        </div>
    </div>
    <div class="form-group">
        <label class="control-label col-md-3 col-sm-3 col-xs-12" for="packagingway">
            打包费用
        </label>
        <div class="col-md-6 col-sm-6 col-xs-12">
            <input type="text" id="packagingCosts" value="@orderview.PackagingCosts" disabled class="form-control col-md-7 col-xs-12">
        </div>
    </div>
    <div class="form-group">
        <label class="control-label col-md-3 col-sm-3 col-xs-12" for="expressway">
            快递方式
        </label>
        <div class="col-md-6 col-sm-6 col-xs-12">
            <input type="text" id="expressway" value="@orderview.ExpressWay" disabled class="form-control col-md-7 col-xs-12">
        </div>
    </div>
    <div class="form-group">
        <label class="control-label col-md-3 col-sm-3 col-xs-12" for="chinacouriernumber">
            国内快递单号 <span class="required">*</span>
        </label>
        <div class="col-md-6 col-sm-6 col-xs-12">
            <input type="text" id="chinacouriernumber" name="chinacouriernumber" value="@orderview.ChinaCourierNumber" required="required" class="form-control col-md-7 col-xs-12">
        </div>
    </div>
    <div class="form-group">
        <label class="control-label col-md-3 col-sm-3 col-xs-12" for="kdfy">
            快递费用(元)
        </label>
        <div class="col-md-6 col-sm-6 col-xs-12">
            <input type="text" id="kdfy" name="kdfy" readonly onblur="parcelweightblur()" value="@orderview.CourierFees" required="required" data-parsley-type="number" data-parsley-min="1" class="form-control col-md-7 col-xs-12">
        </div>
    </div>
    <div class="form-group">
        <label class="control-label col-md-3 col-sm-3 col-xs-12" for="domesticcost">
            国内段费用(元) <span class="required">*</span>
        </label>
        <div class="col-md-6 col-sm-6 col-xs-12">
            <input type="text" id="domesticcost" name="domesticcost" value="@orderview.ParcelWeight" required="required" data-parsley-type="number" data-parsley-min="1" class="form-control col-md-7 col-xs-12">
        </div>
    </div>
    <br />
    <h5>订单金额</h5>
    <hr />
    <div class="form-group">
        <label class="control-label col-md-3 col-sm-3 col-xs-12" for="orderfrees">
            订单总金额 <span class="required">*</span>
        </label>
        <div class="col-md-6 col-sm-6 col-xs-12">
            <input type="text" id="orderfrees" name="orderfrees" required="required" data-parsley-type="number" data-parsley-min="1" value="@orderview.OrderRealPrice" class="form-control col-md-7 col-xs-12">
        </div>
    </div>
    <div class="ln_solid"></div>
    <div class="form-group">
        <div class="col-md-6 col-sm-6 col-xs-12 col-md-offset-3">
            <button type="submit" class="btn btn-success">提 交</button>
        </div>
    </div>

</form>
<script src="~/Scripts/parsley.min.js"></script>
<script src="~/Scripts/jquery.form.js"></script>
<script>
    function goodsweightblur() {
        var cityId = @orderview.RussiaCityId;
        var goodstype=@orderview.GoodsType;
        var transType=@orderview.TransportationWay;
        var isopen = '@orderview.IsOutPhoto';
        @*var daifujine=@orderview.ArrivePayValue;*@
        var weight = $('#goodsweight').val();
        $.getJSON('@Url.Action("GetAddressBudgetPrice")',
            { cityId: cityId, goodstype: goodstype, transType: transType, weight: weight },
            function(e) {
                var s = Number(e.Message);
                if (isopen == 'True')
                    s = s + 5;
                //s = s + Number(daifujine);
                $('#gjdfy').val(s);
                sumprice();
            });
        parcelweightblur();
    }

    function parcelweightblur() {
        var cityId = @orderview.ChinaCityId;
        var expressway = @orderview.ExpressWay;
        var weight = $('#goodsweight').val();
        var dbf = 0;
        if (Number(weight) <= 1) {
            dbf = 5;
        }
        if (1 < Number(weight) <= 2) {
            dbf = 7;
        }
        if (2 < Number(weight) <= 5) {
            dbf = 10;
        }
        if (5 < Number(weight)) {
            dbf = 15;
        }
        $('#packagingCosts').val(dbf);

        $.getJSON('@Url.Action("GetRBudgetPrice")',
            { cid: cityId, eway: expressway, weight: weight },
            function(e) {
                $('#kdfy').val(e.Message);
                $('#domesticcost').val(dbf+Number(e.Message));
                sumprice();
            });
    }

    function sumprice() {
        var p1=$('#gjdfy').val();
        var p2=$('#domesticcost').val();
        if (p1.length <= 0)
            p1 = 0;
        if (p2.length <= 0)
            p1 = 0;
        $('#orderfrees').val(Number(p1)+Number(p2));
    }

    $(function() {
        $('#transportationway').val(Status_7077.getCargoTransWay(@orderview.TransportationWay));
        $('#packagingway').val(Status_7077.getPackagingType(@orderview.PackagingWay));
        $('#expressway').val(Status_7077.getExpressWay(@orderview.ExpressWay));
        $('#isoutphoto').val('@orderview.IsOutPhoto'=='True'?'5':'无');
        $('form').ajaxForm({
            resetForm: true,
            error: function (xhr, status, error, $form) {
                $('#alert-infor').removeClass('alert-success');
                $('#alert-infor').addClass('alert-danger');
                $('#alert-infor').show();
                $('#alert-infor label').html(error);
                $('#alert-infor strong').html('错误！');
            },
            success: function (responseText, statusText) {
                $('#main-page')
                         .load("@Url.Action("OrderManage")",
                             function (e) {
                                 $('body').mLoading("hide"); //显示loading组件
                             });
            }
        });
    })
</script>